package com.example.studentCourses.serviceLayer;

import java.time.LocalDateTime;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import com.example.studentCourses.Entity.RegisteredInstructorsEntity;
import com.example.studentCourses.dtos.InstructorLoginRequest;
import com.example.studentCourses.dtos.InstructorResponse;
import com.example.studentCourses.repository.RegisteredInstructorsRespository;

@Service
public class RegisteredInstructorsService {

    @Autowired
    private RegisteredInstructorsRespository registeredInstructorsRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    // Register Instructor
    public RegisteredInstructorsEntity registerInstructor(RegisteredInstructorsEntity instructor) {
        String hashedPassword = passwordEncoder.encode(instructor.getiPassword());
        instructor.setiPassword(hashedPassword);
        instructor.setiCreatedAt(LocalDateTime.now());
        instructor.setiUpdatedAt(LocalDateTime.now());
        return registeredInstructorsRepository.save(instructor);
    }

    // Login Instructor 
    public InstructorResponse loginInstructor(InstructorLoginRequest instructorRequest) {

        RegisteredInstructorsEntity storedInstructor = registeredInstructorsRepository.findByIEmail(instructorRequest.getEmail());

        if (storedInstructor == null) {
            return null;
        }

        boolean passwordMatch = passwordEncoder.matches(
                instructorRequest.getPassword(),
                storedInstructor.getiPassword()
        );

        if (!passwordMatch) {
            return null;
        }

        InstructorResponse response = new InstructorResponse();
        response.setId(storedInstructor.getiId());
        response.setFirstName(storedInstructor.getiFirstName());
        response.setLastName(storedInstructor.getiLastName());
        response.setEmail(storedInstructor.getiEmail());
        response.setBio(storedInstructor.getiBio());
        response.setCreatedAt(storedInstructor.getiCreatedAt());
        response.setUpdatedAt(storedInstructor.getiUpdatedAt());

        return response;
    }
}
